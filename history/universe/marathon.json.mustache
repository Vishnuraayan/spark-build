{
    "id": "{{service.name}}",
    "cpus": {{service.cpus}},
    "mem": {{service.mem}},
    "user": "{{service.user}}",
    {{#security.kerberos.enabled}}
    "cmd": "cat /opt/spark/hdfs.keytab && sleep 150 && SPARK_HISTORY_OPTS=\"-Dspark.history.ui.port=${PORT0} ${SPARK_HISTORY_OPTS} ${SPARK_HISTORY_KERBEROS_OPTS}\" ./bin/spark-class org.apache.spark.deploy.history.HistoryServer",
    {{/security.kerberos.enabled}}
    {{^security.kerberos.enabled}}
    "cmd": "SPARK_HISTORY_OPTS=\"-Dspark.history.ui.port=${PORT0} ${SPARK_HISTORY_OPTS}\" ./bin/spark-class org.apache.spark.deploy.history.HistoryServer",
    {{/security.kerberos.enabled}}
    "env": {
        "SPARK_USER": "{{service.user}}",
        "APPLICATION_WEB_PROXY_BASE": "/service/{{service.name}}",
        {{#security.kerberos.enabled}}
            {{#security.kerberos.krb5conf}}
            "KRB5_CONFIG_BASE64": "{{security.kerberos.krb5conf}}",
            {{/security.kerberos.krb5conf}}
            {{#security.kerberos.kdc.hostname}}
            "SPARK_SECURITY_KERBEROS_KDC_HOSTNAME": "{{security.kerberos.kdc.hostname}}",
            {{/security.kerberos.kdc.hostname}}
            {{#security.kerberos.kdc.port}}
            "SPARK_SECURITY_KERBEROS_KDC_PORT": "{{security.kerberos.kdc.port}}",
            {{/security.kerberos.kdc.port}}
            {{#security.kerberos.realm}}
            "SPARK_SECURITY_KERBEROS_REALM": "{{security.kerberos.realm}}",
            {{/security.kerberos.realm}}
            "SPARK_HISTORY_KERBEROS_OPTS": "-Dspark.history.kerberos.enabled=true -Dspark.history.kerberos.principal={{security.kerberos.principal}} -Dspark.history.kerberos.keytab=/opt/spark/hdfs.keytab",
        {{/security.kerberos.enabled}}
        "SPARK_HISTORY_OPTS": "-Dspark.history.fs.logDirectory={{service.log-dir}} -Dspark.history.fs.cleaner.enabled={{service.cleaner.enabled}} -Dspark.history.fs.cleaner.interval={{service.cleaner.interval}} -Dspark.history.fs.cleaner.maxAge={{service.cleaner.max-age}}"
    },
    "ports": [0],
    "container": {
        {{#service.UCR_containerizer}}
        "type": "MESOS",
        "docker": {
            {{#service.docker-image}}
            "image": "{{service.docker-image}}",
            {{/service.docker-image}}
            {{^service.docker-image}}
            "image": "{{resource.assets.container.docker.spark_docker}}",
            {{/service.docker-image}}
            "forcePullImage": true
        }
        {{/service.UCR_containerizer}}
        {{^service.UCR_containerizer}}
        "type": "DOCKER",
        "docker": {
            {{#service.docker-image}}
                "image": "{{service.docker-image}}",
            {{/service.docker-image}}
            {{^service.docker-image}}
                "image": "{{resource.assets.container.docker.spark_docker}}",
            {{/service.docker-image}}
            {{^service.virtual_network_enabled}}
                "network": "HOST",
            {{/service.virtual_network_enabled}}
            {{#service.docker_user}}
                "parameters": [
                    {
                        "key": "user",
                        "value": "{{service.docker_user}}"
                    }
                ],
            {{/service.docker_user}}
            {{^service.docker_user}}
                "parameters": [
                    {
                        "key": "user",
                        "value": "{{service.user}}"
                    }
                ],
            {{/service.docker_user}}
            "forcePullImage": true
        }
        {{/service.UCR_containerizer}}
        {{#security.kerberos.keytab}}
        ,
        "volumes": [
            {
                "containerPath": "/opt/spark/hdfs.keytab",
                "secret": "hdfs_keytab",
                "hostPath": ""
            }
        ]
        {{/security.kerberos.keytab}}
    },
    {{#security.kerberos.keytab}}
    "secrets": {
        "hdfs_keytab": {
            "source": "{{security.kerberos.keytab}}"
        }
    },
    {{/security.kerberos.keytab}}
    "healthChecks": [
        {
            "protocol": "MESOS_HTTP",
            "path": "/",
            "portIndex": 0,
            "gracePeriodSeconds": 5,
            "intervalSeconds": 60,
            "timeoutSeconds": 10,
            "maxConsecutiveFailures": 3
        }
    ],
    "labels": {
        "DCOS_SERVICE_NAME": "{{service.name}}",
        "DCOS_SERVICE_PORT_INDEX": "0",
        "DCOS_SERVICE_SCHEME": "http"
    },
    "uris": [
        "{{service.hdfs-config-url}}/hdfs-site.xml",
        "{{service.hdfs-config-url}}/core-site.xml"
    ]
}
